import SwiftUI

@main
struct ArtifactApp: App {
    let dataStore = ArtifactStore()
    var body: some Scene {
        WindowGroup {
            ArtifactFeedView()
                .environmentObject(dataStore)
        }
    }
}
import Foundation
import SwiftUI
import RealityKit

struct Artifact: Identifiable, Codable {
    var id = UUID()
    var name: String
    var scanDate: Date
    var width: Double
    var height: Double
    var length: Double
    var weight: Double
    var captureMethod: String
    var notes: String
    var imagePath: String
    var modelPath: String
}
import Foundation

class ArtifactStore: ObservableObject {
    @Published var artifacts: [Artifact] = []
    let saveURL: URL

    init() {
        let docs = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!
        saveURL = docs.appendingPathComponent("artifacts.json")
        load()
    }

    func add(_ artifact: Artifact) {
        artifacts.append(artifact)
        save()
    }

    func save() {
        let encoder = JSONEncoder()
        encoder.outputFormatting = .prettyPrinted
        if let data = try? encoder.encode(artifacts) {
            try? data.write(to: saveURL)
        }
    }

    func load() {
        if let data = try? Data(contentsOf: saveURL) {
            let decoder = JSONDecoder()
            if let decoded = try? decoder.decode([Artifact].self, from: data) {
                artifacts = decoded
            }
        }
    }
}
import SwiftUI

struct ArtifactFeedView: View {
    @EnvironmentObject var store: ArtifactStore
    @State private var search = ""

    var filtered: [Artifact] {
        if search.isEmpty { return store.artifacts }
        return store.artifacts.filter {
            $0.name.lowercased().contains(search.lowercased())
        }
    }

    var body: some View {
        NavigationView {
            VStack {
                TextField("Search artifacts…", text: $search)
                    .padding()
                    .textFieldStyle(RoundedBorderTextFieldStyle())

                List(filtered) { artifact in
                    NavigationLink(destination: ArtifactDetailView(artifact: artifact)) {
                        HStack {
                            if let img = UIImage(contentsOfFile: artifact.imagePath) {
                                Image(uiImage: img)
                                    .resizable()
                                    .frame(width: 60, height: 60)
                                    .clipShape(RoundedRectangle(cornerRadius: 8))
                            }
                            VStack(alignment: .leading) {
                                Text(artifact.name).font(.headline)
                                Text(artifact.captureMethod).font(.subheadline)
                            }
                        }
                    }
                }
            }
            .navigationTitle("Digital Twins")
            .toolbar {
                NavigationLink(destination: CaptureView()) {
                    Image(systemName: "plus.circle.fill").font(.largeTitle)
                }
            }
        }
    }
}
import SwiftUI

struct ArtifactFeedView: View {
    @EnvironmentObject var store: ArtifactStore
    @State private var search = ""

    var filtered: [Artifact] {
        if search.isEmpty { return store.artifacts }
        return store.artifacts.filter {
            $0.name.lowercased().contains(search.lowercased())
        }
    }

    var body: some View {
        NavigationView {
            VStack {
                TextField("Search artifacts…", text: $search)
                    .padding()
                    .textFieldStyle(RoundedBorderTextFieldStyle())

                List(filtered) { artifact in
                    NavigationLink(destination: ArtifactDetailView(artifact: artifact)) {
                        HStack {
                            if let img = UIImage(contentsOfFile: artifact.imagePath) {
                                Image(uiImage: img)
                                    .resizable()
                                    .frame(width: 60, height: 60)
                                    .clipShape(RoundedRectangle(cornerRadius: 8))
                            }
                            VStack(alignment: .leading) {
                                Text(artifact.name).font(.headline)
                                Text(artifact.captureMethod).font(.subheadline)
                            }
                        }
                    }
                }
            }
            .navigationTitle("Digital Twins")
            .toolbar {
                NavigationLink(destination: CaptureView()) {
                    Image(systemName: "plus.circle.fill").font(.largeTitle)
                }
            }
        }
    }
}
import SwiftUI

struct ArtifactFeedView: View {
    @EnvironmentObject var store: ArtifactStore
    @State private var search = ""

    var filtered: [Artifact] {
        if search.isEmpty { return store.artifacts }
        return store.artifacts.filter {
            $0.name.lowercased().contains(search.lowercased())
        }
    }

    var body: some View {
        NavigationView {
            VStack {
                TextField("Search artifacts…", text: $search)
                    .padding()
                    .textFieldStyle(RoundedBorderTextFieldStyle())

                List(filtered) { artifact in
                    NavigationLink(destination: ArtifactDetailView(artifact: artifact)) {
                        HStack {
                            if let img = UIImage(contentsOfFile: artifact.imagePath) {
                                Image(uiImage: img)
                                    .resizable()
                                    .frame(width: 60, height: 60)
                                    .clipShape(RoundedRectangle(cornerRadius: 8))
                            }
                            VStack(alignment: .leading) {
                                Text(artifact.name).font(.headline)
                                Text(artifact.captureMethod).font(.subheadline)
                            }
                        }
                    }
                }
            }
            .navigationTitle("Digital Twins")
            .toolbar {
                NavigationLink(destination: CaptureView()) {
                    Image(systemName: "plus.circle.fill").font(.largeTitle)
                }
            }
        }
    }
}
import SwiftUI
import RealityKit

struct ArtifactDetailView: View {
    var artifact: Artifact

    var body: some View {
        ScrollView {
            VStack(spacing: 20) {

                if let img = UIImage(contentsOfFile: artifact.imagePath) {
                    Image(uiImage: img)
                        .resizable()
                        .scaledToFit()
                        .frame(height: 280)
                }

                if FileManager.default.fileExists(atPath: artifact.modelPath) {
                    Model3D(url: URL(fileURLWithPath: artifact.modelPath))
                        .frame(height: 300)
                }

                Group {
                    info("Name", artifact.name)
                    info("Width", "\(artifact.width)")
                    info("Height", "\(artifact.height)")
                    info("Length", "\(artifact.length)")
                    info("Weight", "\(artifact.weight)")
                    info("Capture Method", artifact.captureMethod)
                    info("Notes", artifact.notes)
                }
            }
            .padding()
        }
        .navigationTitle("Artifact Details")
    }

    func info(_ title: String, _ value: String) -> some View {
        HStack {
            Text(title + ":").bold()
            Spacer()
            Text(value)
        }
    }
}
import SwiftUI

struct CaptureView: View {
    @State private var showCamera = false
    @State private var capturedImage: UIImage?
    @State private var name = ""
    @State private var width = ""
    @State private var height = ""
    @State private var length = ""
    @State private var weight = ""
    @State private var notes = ""
    @State private var captureMethod = "Laser + Photogrammetry"

    @EnvironmentObject var store: ArtifactStore
    @Environment(\.presentationMode) var presentation

    var body: some View {
        ScrollView {
            VStack(spacing: 20) {
                Button {
                    showCamera = true
                } label: {
                    if let img = capturedImage {
                        Image(uiImage: img)
                            .resizable()
                            .scaledToFit()
                            .frame(height: 300)
                    } else {
                        ZStack {
                            RoundedRectangle(cornerRadius: 12).fill(Color.gray.opacity(0.2))
                                .frame(height: 300)
                            Text("Tap to Capture Artifact")
                        }
                    }
                }

                TextField("Artifact Name", text: $name)
                    .textFieldStyle(RoundedBorderTextFieldStyle())

                Group {
                    TextField("Width (cm)", text: $width)
                    TextField("Height (cm)", text: $height)
                    TextField("Length (cm)", text: $length)
                    TextField("Weight (g)", text: $weight)
                }
                .keyboardType(.decimalPad)
                .textFieldStyle(RoundedBorderTextFieldStyle())

                TextField("Notes", text: $notes)
                    .textFieldStyle(RoundedBorderTextFieldStyle())

                Button("Save Artifact") {
                    saveArtifact()
                }
                .buttonStyle(.borderedProminent)
            }
            .padding()
        }
        .sheet(isPresented: $showCamera) {
            CameraView(image: $capturedImage)
        }
    }

    func saveArtifact() {
        guard let img = capturedImage else { return }

        let docs = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first!

        let imgURL = docs.appendingPathComponent(UUID().uuidString + ".jpg")
        if let data = img.jpegData(compressionQuality: 0.9) {
            try? data.write(to: imgURL)
        }

        let modelURL = docs.appendingPathComponent(UUID().uuidString + ".usdz")

        FileManager.default.createFile(atPath: modelURL.path, contents: Data(), attributes: nil)

        let artifact = Artifact(
            name: name,
            scanDate: Date(),
            width: Double(width) ?? 0,
            height: Double(height) ?? 0,
            length: Double(length) ?? 0,
            weight: Double(weight) ?? 0,
            captureMethod: captureMethod,
            notes: notes,
            imagePath: imgURL.path,
            modelPath: modelURL.path
        )

        store.add(artifact)
        presentation.wrappedValue.dismiss()
    }
}
import SwiftUI

struct CameraView: UIViewControllerRepresentable {
    @Binding var image: UIImage?
    func makeCoordinator() -> Coordinator { Coordinator(self) }

    func makeUIViewController(context: Context) -> UIImagePickerController {
        let picker = UIImagePickerController()
        picker.sourceType = .camera
        picker.delegate = context.coordinator
        return picker
    }

    func updateUIViewController(_ uiViewController: UIImagePickerController, context: Context) {}

    class Coordinator: NSObject, UINavigationControllerDelegate, UIImagePickerControllerDelegate {
        let parent: CameraView
        init(_ parent: CameraView) { self.parent = parent }

        func imagePickerController(_ picker: UIImagePickerController,
                                   didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey : Any]) {
            if let img = info[.originalImage] as? UIImage {
                parent.image = img
            }
            picker.dismiss(animated: true)
        }
    }
}
